<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="height=device-height, initial-scale=1.0">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="style.css">
        <title>ZIOM</title>
    </head>
    <body>
    
    <div id="overlay">
        <div id="alerts"></div>
        
        <div id="initScreen" class="fulllay">
            <noscript>
                <pre>
EN: Javascript is disabled.
CZ: Máte vypnutý Javascript.
                </pre>
            </noscript>
            
            
            <img id="logo" src="images/ZIOM.png" style="display: none">
            
            <div id="loadingBar-wrap" style="display: none;">
                Loading...
                <div class="text"></div>
                <div id="loadingBar">
                    <div id="loadingBar-progress" style="width: 0%;">0%</div>
                </div>
            </div>
        </div>
        
        <div id="controls" class="runtimeui" style="display: none">
            <div id="nav">
                <ul class="menu">
                    <li><div class="menu-item" style="border-left: 0">
                        <form id="langSelect-form">
                            <i class="fas fa-language fa-lg"></i>
                            <select id="langSelect">
                                <option value="en">English</option>
                                <option value="cs">Česky</option>
                            </select> 
                        </form>
                    </div></li>
                    
                    <li><button class="menu-item trn nav-item" style="" data-name="reset" data-trn="reset">reset</button></li>
                </ul>
            </div>
            
            <div id="options">
                <ul class="menu">
                    <li><button class="menu-item trn nav-item" style="" data-name="all" data-trn="everyting">waypoint</button></li>
                </ul>
            </div>
        </div>
        
        <div id="stats" class="runtimeui" style="display: none"></div>
    </div>
    
    <canvas id="canvas"></canvas>
    
    <!-- js -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/translation.js"></script>
    <script src="js/jquery.detectmobilebrowser.js"></script>
    <script src="js/jquery.draglessClick.js"></script>
    <script src="js/three.min.js"></script>
    <script src="js/app/app.js"></script>
    
    <script>
        $(window).one("load", () => {
            $("#logo").delay(100).fadeIn("fast", () => {
                try{
                
                    App.init();
                    
                }catch(error){
                
                    console.error(error);
                    $("#alerts").append($("#TEMPLATES > .alert-error").clone().hide().text("Initialization failed: "+error).delay(1).slideDown());
                    
                }
            });
        });
        
        function contextLost(){
            $("#alerts").append($("#TEMPLATES > .alert-error").clone().attr("id", "contextlost").hide().text("WebGL context lost! Maybe insufficent RAM?").delay(1).slideDown());
        }
        function contextRestored(){
            $("#contextlost").slideUp().remove();
            $("#alerts").append($("#TEMPLATES > .alert-success").clone().attr("id", "contextrestored").hide().text("WebGL context RESTORED!").delay(1).slideDown());
            
            setTimeout(() => {
                $("#contextrestored").slideUp().remove();
            }, 2500);
        }
        
        
        $(document).one("ZIOM-initialized", () => {
            console.log("Initialization complete.");
            
            $("#loadingBar-wrap").slideDown("fast", () => {
                App.loadLibs();
            });
        });
        
        
        $(document).on("ZIOM-libLoaded", (ev, info) => {
            console.log("Loaded "+info[0]);
            $("#loadingBar-wrap .text").text(info[0]+" | "+info[1]+"/"+(info[2]+info[1]));
            
            let percent = ((info[1] / (info[1] + info[2])) * 100);
            
            $("#loadingBar-progress").animate({
                width: percent + "%"
            }, 10).text(Math.round(percent) + "%");
        });
        
        
        $(document).one("ZIOM-libsReady", () => {
            App.loadModel("sspbrno");
        });
        
        
        $(document).one("ZIOM-modelInit", (ev, name, color) => {
            console.log("Loading "+name);
            $("#loadingBar-wrap .text").text("model");

            $("#loadingBar-progress").finish().width("100%").css("background-color", color).addClass("pulsing").text(name);
            
            App.model.load();
        });
        
        
        $(document).one("ZIOM-modelReady", () => {
            $("#langSelect").val($.lang).on("input", (ev) => {
                $.lang = $(ev.target).val();
                $(".trn").translate();
            });
        
            $("#initScreen").delay(500).fadeOut();
            $(".runtimeui").fadeIn();
        });
        
    </script>
    
    <!-- templates -->
    <div id="TEMPLATES" style="display: none">
    
        <div class="alert-error alert">
            <div class="text"></div>
        </div>
        
    </div>
    
    </body>
</html>
